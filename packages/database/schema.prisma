generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  VIP
  PREMIUM
  ADMIN
  SUPER_ADMIN
}

enum Currency {
  BTC
  ETH
  LTC
  USDT
  USD
  EUR
}

enum BetStatus {
  PENDING
  WON
  LOST
  REFUNDED
}

enum JackpotStatus {
  REFILLING
  READY
  MEGA
  CALCULATING
}

enum GameType {
  DICE
  LIMBO
  CRASH
  MINES
  PLINKO
  ROULETTE
  FASTPARITY
  KENO
  TOWER
  HILO
  BLACKJACK
  WHEEL
  BALLOON
  RUSH
  COINFLIP
  TRENBALL
  LUDO
  CHESS
  STAIRS
}

model User {
  id            String   @id @default(cuid())
  username      String   @unique
  email         String   @unique
  passwordHash  String
  role          UserRole @default(USER)
  level         Int      @default(1)
  xp            Float    @default(0)
  isVip         Boolean  @default(false)
  isPremium     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  wallets       Wallet[]
  bets          Bet[]
  seeds         SeedPair[]
  settings      UserSettings?
  strategies    Strategy[]
  rakebacks     Rakeback[]
  activities    UserActivity[]
  favorites     FavoriteGame[]
  stats         UserStats?

  @@index([username])
  @@index([email])
}

model UserSettings {
  id              String  @id @default(cuid())
  userId          String  @unique
  user            User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  animations      Boolean @default(true)
  hotkeysEnabled  Boolean @default(true)
  soundEnabled    Boolean @default(true)
  soundVolume     Float   @default(0.5)
  showMaxBet      Boolean @default(true)
  instantBet      Boolean @default(false)
  theatreMode     Boolean @default(false)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model UserStats {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  totalWagered  Float    @default(0)
  totalProfit   Float    @default(0)
  totalWins     Int      @default(0)
  totalLosses   Int      @default(0)
  
  updatedAt     DateTime @updatedAt
}

model Wallet {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  currency      Currency
  balance       Float    @default(0)
  lockedBalance Float    @default(0)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([userId, currency])
  @@index([userId])
}

model SeedPair {
  id              String   @id @default(cuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  serverSeed      String
  serverSeedHash  String
  clientSeed      String
  nonce           Int      @default(0)
  isActive        Boolean  @default(true)
  revealed        Boolean  @default(false)
  
  createdAt       DateTime @default(now())
  revealedAt      DateTime?
  
  bets            Bet[]

  @@index([userId, isActive])
}

model Bet {
  id              String    @id @default(cuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  gameType        GameType
  currency        Currency
  amount          Float
  multiplier      Float
  payout          Float     @default(0)
  profit          Float     @default(0)
  status          BetStatus @default(PENDING)
  
  seedPairId      String
  seedPair        SeedPair  @relation(fields: [seedPairId], references: [id])
  nonce           Int
  
  gameData        Json
  result          Json
  
  isDemo          Boolean   @default(false)
  isAutoBet       Boolean   @default(false)
  strategyId      String?
  
  createdAt       DateTime  @default(now())

  @@index([userId])
  @@index([gameType])
  @@index([createdAt])
  @@index([status])
}

model Jackpot {
  id              String        @id @default(cuid())
  gameType        GameType?
  currency        Currency?
  
  currentAmount   Float         @default(0)
  minAmount       Float         @default(0)
  status          JackpotStatus @default(REFILLING)
  
  houseEdgePercent Float        @default(1)
  
  conditions      Json
  
  lastWinnerId    String?
  lastWinAmount   Float?
  lastWinAt       DateTime?
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  wins            JackpotWin[]

  @@index([gameType, currency])
  @@index([status])
}

model JackpotWin {
  id          String   @id @default(cuid())
  jackpotId   String
  jackpot     Jackpot  @relation(fields: [jackpotId], references: [id])
  
  userId      String
  amount      Float
  currency    Currency
  
  createdAt   DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
}

model Strategy {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title         String
  description   String?
  gameType      GameType
  
  isPublic      Boolean  @default(false)
  commission    Float    @default(0)
  
  conditions    Json
  script        String?
  
  totalUses     Int      @default(0)
  totalProfit   Float    @default(0)
  aum           Float    @default(0)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([userId])
  @@index([isPublic])
  @@index([gameType])
}

model Contest {
  id            String   @id @default(cuid())
  title         String
  type          String
  currency      Currency?
  
  prizePool     Float
  startAt       DateTime
  endAt         DateTime
  
  conditions    Json
  prizes        Json
  
  lastWinnerId  String?
  
  createdAt     DateTime @default(now())
  
  entries       ContestEntry[]

  @@index([startAt, endAt])
}

model ContestEntry {
  id          String   @id @default(cuid())
  contestId   String
  contest     Contest  @relation(fields: [contestId], references: [id], onDelete: Cascade)
  
  userId      String
  wagered     Float    @default(0)
  profit      Float    @default(0)
  rank        Int?
  prize       Float?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([contestId, userId])
  @@index([contestId, wagered])
}

model Rakeback {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  currency    Currency
  amount      Float
  claimed     Boolean  @default(false)
  claimedAt   DateTime?
  
  createdAt   DateTime @default(now())

  @@index([userId, claimed])
}

model GameConfig {
  id          String   @id @default(cuid())
  gameType    GameType @unique
  
  houseEdge   Float
  minBet      Json
  maxBet      Json
  maxWin      Json
  
  isEnabled   Boolean  @default(true)
  config      Json
  
  updatedAt   DateTime @updatedAt
}

model FavoriteGame {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  gameType  GameType
  
  createdAt DateTime @default(now())

  @@unique([userId, gameType])
}

model UserActivity {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  activity    String
  description String?
  severity    String
  metadata    Json?
  
  createdAt   DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
}

model CrashRound {
  id          String   @id @default(cuid())
  roundNumber Int      @unique
  
  crashPoint  Float
  hash        String
  
  startedAt   DateTime
  crashedAt   DateTime?
  
  bets        CrashBet[]

  @@index([roundNumber])
}

model CrashBet {
  id          String     @id @default(cuid())
  roundId     String
  round       CrashRound @relation(fields: [roundId], references: [id])
  
  userId      String
  currency    Currency
  amount      Float
  
  autoCashout Float?
  cashedOut   Boolean    @default(false)
  cashoutAt   Float?
  payout      Float      @default(0)
  
  createdAt   DateTime   @default(now())

  @@index([roundId])
  @@index([userId])
}
